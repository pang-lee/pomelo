<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Pomelo</title>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta http-equiv="content-style-type" content="text/css" />
    <meta http-equiv="content-scripte-type" content="text/javascript" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" >
    <meta name="theme-color" content="#FFE1C4" />
    <meta name="author" content="netease" />
    <meta name="version" content="1.0" />
    <meta name="keywords" content="pomelo" />
    <meta name="theme-color"/>
    <link type="text/css" rel="stylesheet" href="css/base.css" />
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/image/icon/icon-96x96.png"/>
    <meta name="apple-mobile-web-app-status-bar" content="#aa7700"/>
    <script src="js/app.js"></script>
    <script src="js/lib/socket.io.js"></script>
    <script src="js/lib/pomeloclient.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.css"/>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.min.js"></script>
    <script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="https://unpkg.com/vuex"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
    <script src="https://unpkg.com/vue-disqus"></script>
    <script src="https://unpkg.com/http-vue-loader"></script>
    <script src="/js/vue/vuex.js"></script>
    <script src="/js/vue/router.js"></script>
    <script src="/js/vue/vue.js"></script>
    <script type="text/javascript">
      var pomelo = window.pomelo;
      var host = "127.0.0.1";
      var port = "3010";
      function show() {
        pomelo.init({
          host: host,
          port: port,
          log: true
        }, function() {
        pomelo.request("connector.entryHandler.entry", "hello pomelo", function(data) {
            alert(data.msg);
          });
        });
      }
    </script>
  </head>
  <body>
    <div id="app">
      <navbar></navbar>
      <transition name="fade" mode="out-in">
        <router-view></router-view>
      </transition>
    </div>
    <div class="guide"></div>
    <div class="recipe"></div>
    <div>
      <form>
        <p>Name:</p>
        <p><input id="title" type="text" name="name" value="你的名字"></p>
        <p>Email:</p>
        <p><input id="ingredient" name="species" type="text"></p>
        <p><input type="submit" value="送出資料"></p>
      </form>
    </div>

    <footer class="site-footer">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <h6>About</h6>
            <p class="text-justify">Scanfcode.com <i>CODE WANTS TO BE SIMPLE </i> is an initiative  to help the upcoming programmers with the code. Scanfcode focuses on providing the most efficient code or snippets as the code wants to be simple. We will help programmers build up concepts in different programming languages that include C, C++, Java, HTML, CSS, Bootstrap, JavaScript, PHP, Android, SQL and Algorithm.</p>
          </div>

          <div class="col-xs-6 col-md-3">
            <h6>Categories</h6>
            <ul class="footer-links">
              <li><a href="http://scanfcode.com/category/c-language/">C</a></li>
              <li><a href="http://scanfcode.com/category/front-end-development/">UI Design</a></li>
              <li><a href="http://scanfcode.com/category/back-end-development/">PHP</a></li>
              <li><a href="http://scanfcode.com/category/java-programming-language/">Java</a></li>
              <li><a href="http://scanfcode.com/category/android/">Android</a></li>
              <li><a href="http://scanfcode.com/category/templates/">Templates</a></li>
            </ul>
          </div>

          <div class="col-xs-6 col-md-3">
            <h6>Quick Links</h6>
            <ul class="footer-links">
              <li><a href="http://scanfcode.com/about/">About Us</a></li>
              <li><a href="http://scanfcode.com/contact/">Contact Us</a></li>
              <li><a href="http://scanfcode.com/contribute-at-scanfcode/">Contribute</a></li>
              <li><a href="http://scanfcode.com/privacy-policy/">Privacy Policy</a></li>
              <li><a href="http://scanfcode.com/sitemap/">Sitemap</a></li>
            </ul>
          </div>
        </div>
        <hr>
      </div>
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-6 col-xs-12">
            <p class="copyright-text">Copyright &copy; 2017 All Rights Reserved by 
              <a href="#">Scanfcode</a>.
            </p>
          </div>

          <div class="col-md-4 col-sm-6 col-xs-12">
            <ul class="social-icons">
              <li><a class="facebook" href="#"><i class="fa fa-facebook"></i></a></li>
              <li><a class="twitter" href="#"><i class="fa fa-twitter"></i></a></li>
              <li><a class="dribbble" href="#"><i class="fa fa-dribbble"></i></a></li>
              <li><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a></li>   
            </ul>
          </div>
        </div>
      </div>
    </footer>
  </body>

  <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-analytics.js"></script>

  <script>
    var firebaseConfig = {
      apiKey: "AIzaSyDjCY3KmtAfrvYzH-d6jXeBWnTFLSICIfA",
      authDomain: "pomelo-a53a7.firebaseapp.com",
      databaseURL: "https://pomelo-a53a7.firebaseio.com",
      projectId: "pomelo-a53a7",
      storageBucket: "pomelo-a53a7.appspot.com",
      messagingSenderId: "510530322503",
      appId: "1:510530322503:web:a1f9199b4b52b380c13162",
      measurementId: "G-ZDNE5QY46N"
    }

    firebase.initializeApp(firebaseConfig)
    firebase.analytics()
    
    const db = firebase.firestore()

    const setupGuide = (data) => {
      if(data.length){
        let html = ''
        data.forEach((doc) => {
          const guide = doc.data()
          const li = `<div>
                        <div>${guide.title}</div>
                        <div>${guide.content}</div>
                      </div>`
          html += li
        })
        document.querySelector('.guide').innerHTML = html
      }else{
        document.querySelector('.guide').innerHTML = '<h3>Please Login</h3>'
      }
    }

    firebase.auth().onAuthStateChanged((user) => {
      if(user){
        db.collection('guide').get().then((snapshot) => {
          setupGuide(snapshot.docs)
        })
      }else{
        setupGuide([])
      }
    })

    const renderRecipe = (data, id) => {
      document.querySelector('.recipe').innerHTML += `
      <div class="datarecipe" data-id="${id}">
        <div>${data.title}</div>
        <div>${data.ingredient}</div>
        <i data-id="${id}">delete</i>
      </div>`
    }

    const removeRecipe = (id) => {
      const recipe = document.querySelector(`.datarecipe[data-id=${id}]`)
      recipe.remove()
    }

    db.collection('recipe').onSnapshot((snapshot) => {
      snapshot.docChanges().forEach((change) => {
        if(change.type === 'added'){
          renderRecipe(change.doc.data(), change.doc.id)
        }else if(change.type === 'removed'){
          removeRecipe(change.doc.id)
        }
      })
    })

    const form = document.querySelector('form')
    form.addEventListener('submit', (evt) => {
      evt.preventDefault();
      const insert = {
        title: form.title.value,
        ingredient: form.ingredient.value
      }

    db.collection('recipe').add(insert).catch((err) => console.log(err))
      form.title.value = ''
      form.ingredient.value = ''
    })

    const recipeContainer = document.querySelector('.recipe')
    recipeContainer.addEventListener('click', (evt) => {
      if(evt.target.tagName === 'I'){
        const id = evt.target.getAttribute('data-id')
        db.collection('recipe').doc(id).delete();
      }
    })
  </script>
</html>
